
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="zh-cn" xml:lang="zh-cn">
<head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="DC.Type" content="topic">
<meta name="DC.Title" content="配置网口0或网口1~4路由信息">
<meta name="DC.Format" content="XHTML">
<meta name="DC.Identifier" content="ZH-CN_TOPIC_0000001447121185">
<meta name="DC.Language" content="zh-cn">
<title>配置网口0或网口1~4路由信息</title>
</head>
<body><a name="ZH-CN_TOPIC_0000001447121185"></a><a name="ZH-CN_TOPIC_0000001447121185"></a>

<h1 class="topictitle1">配置网口0或网口1~4路由信息</h1>
<div id="body8662426"><div class="section" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_section1858716118469"><h4 class="sectiontitle">操作场景</h4><p id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_p4440626316">该任务指导用户在网口0或网口1~4跨网段对外通信场景下，配置网口0或网口1~4的路由信息。</p>
</div>
<div class="section" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_section192549215467"><h4 class="sectiontitle">组网示例</h4><p id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_p010810764817">以<a href="#ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_fig16381238144718">图1</a>为例，假设<span id="ZH-CN_TOPIC_0000001447121185__text618383215">Atlas 500 A2 智能小站</span>网口0或网口1~4所在网段为172.16.32.xx网段，需要与172.17.22.xx网段进行通信，请按照<a href="#ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_section9818135324817">操作步骤</a>进行配置。</p>
<div class="fignone" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_fig16381238144718"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_fig16381238144718"></a><a name="zh-cn_topic_0201081113_fig16381238144718"></a><span class="figcap"><b>图1 </b>组网</span><br><span><img class="eddx" id="ZH-CN_TOPIC_0000001447121185__image77781891514" src="../images/zh-cn_image_0000001692059641.png" width="521.36" height="255.98935600000002"></span></div>
</div>
<div class="section" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_section9818135324817"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_section9818135324817"></a><a name="zh-cn_topic_0201081113_section9818135324817"></a><h4 class="sectiontitle">操作步骤</h4><ol id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_ol944212375215"><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li825843811524"><span>使用与<span id="ZH-CN_TOPIC_0000001447121185__text1035172063">Atlas 500 A2 智能小站</span>网口0或网口1~4同网段的PC，登录<span id="ZH-CN_TOPIC_0000001447121185__ph15786811606">Atlas IES</span>命令行界面，详细信息请参见<a href="zh-cn_topic_0000001527092529.html">使用PuTTY登录设备（网口方式）</a>。</span></li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0240049165_zh-cn_topic_0173591765_li285395853010"><span>进入develop模式。</span><p><ol type="a" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0000001389273064_zh-cn_topic_0173591765_ol893109173219"><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0000001389273064_zh-cn_topic_0173591765_li774923517373">执行<strong id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0000001389273064_zh-cn_topic_0173591765_b15749635183712">develop</strong>命令，获取root权限。<p id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0000001389273064_zh-cn_topic_0173591765_p174983517378">回显信息如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0000001389273064_zh-cn_topic_0173591765_screen3749103512371">input root passwd
Password:
Last login: Tue Jun  4 15:38:59 UTC 2019 on pts/0 
Euler:<font style="font-size:8pt" Face="Courier New" >~</font> #</pre>
</li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0000001389273064_zh-cn_topic_0173591765_li1619372419547">按提示输入root密码。默认密码请参见<span id="ZH-CN_TOPIC_0000001447121185__ph343465331014">《<a href="https://support.huawei.com/enterprise/zh/doc/EDOC1100235027" target="_blank" rel="noopener noreferrer">Atlas 系列硬件产品 账户清单</a>》</span>中的“<span id="ZH-CN_TOPIC_0000001447121185__text652727666">Atlas 500 A2 智能小站</span>”章节。</li></ol>
</p></li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li7486850145220"><span>配置路由信息。</span><p><ol type="a" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_ol68891723163317"><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li1643044814359">执行以下命令，查看路由表是否为空。<p id="ZH-CN_TOPIC_0000001447121185__p20774532027"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li1643044814359"></a><a name="zh-cn_topic_0201081113_li1643044814359"></a><strong id="ZH-CN_TOPIC_0000001447121185__b17785316210">policy_based_routing.sh ip route show table</strong> <em id="ZH-CN_TOPIC_0000001447121185__i1825136664">200</em>    # 200表示具体的路由表</p>
<p id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_p154601754133518">显示如下信息，表示路由表为空。</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_screen6752945175319">Euler:<font style="font-size:8pt" Face="Courier New" >~</font> #</pre>
</li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li163070395425">选择一个空路由表，配置路由信息。<ol class="substepthirdol" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_ol197226217451"><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li4765206491">在路由表中增加一条到目的网络的路由，下一跳网关为网口0或网口1~4的网关。<p id="ZH-CN_TOPIC_0000001447121185__p441612381511"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li4765206491"></a><a name="zh-cn_topic_0201081113_li4765206491"></a><strong id="ZH-CN_TOPIC_0000001447121185__b441612381656">policy_based_routing.sh ip route add </strong><em id="ZH-CN_TOPIC_0000001447121185__i24161381859">目的网络</em><strong id="ZH-CN_TOPIC_0000001447121185__b9416173817518"> table </strong><em id="ZH-CN_TOPIC_0000001447121185__i64163382058">路由表</em><strong id="ZH-CN_TOPIC_0000001447121185__b94165381515"> via </strong><em id="ZH-CN_TOPIC_0000001447121185__i1641633820513">eth0/eth1的网关</em></p>
<p id="ZH-CN_TOPIC_0000001447121185__p13274620142914">示例如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__screen35351626122912">policy_based_routing.sh ip route add 172.16.0.0/8 table 200 via 172.16.32.1</pre>
</li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li8225353164818">在路由表中增加策略路由配置。<p id="ZH-CN_TOPIC_0000001447121185__p76055411256"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li8225353164818"></a><a name="zh-cn_topic_0201081113_li8225353164818"></a><strong id="ZH-CN_TOPIC_0000001447121185__b12604184119518">policy_based_routing.sh</strong> <strong id="ZH-CN_TOPIC_0000001447121185__b76043419517">ip rule add </strong><strong id="ZH-CN_TOPIC_0000001447121185__b960510419510">to</strong><em id="ZH-CN_TOPIC_0000001447121185__i660518411654">目的网络</em><strong id="ZH-CN_TOPIC_0000001447121185__b136052411158"> table </strong><em id="ZH-CN_TOPIC_0000001447121185__i86055411457">路由表</em><strong id="ZH-CN_TOPIC_0000001447121185__b260516415512"></strong></p>
<p id="ZH-CN_TOPIC_0000001447121185__p66051757102915">示例如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__screen1550685253315">policy_based_routing.sh ip rule add to 172.16.0.0/8 table 200</pre>
</li></ol>
</li></ol>
</p></li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li16354185685410"><span>执行如下命令，确认跨越网关网络通信是否正常。</span><p><p id="ZH-CN_TOPIC_0000001447121185__p19461226768"><strong id="ZH-CN_TOPIC_0000001447121185__b6946826564">ping</strong> <em id="ZH-CN_TOPIC_0000001447121185__i39467261762">IP地址</em></p>
<p id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_p195911297172">显示如下信息，表示跨越网关网络通信正常。</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_screen1867922617558">PING 172.17.22.164 (172.17.22.164) 56(84) bytes of date.
64 bytes from 172.17.22.164:icmp_seq=1 ttl=125 time=5.48 ms
64 bytes from 172.17.22.164:icmp_seq=2 ttl=125 time=1.96 ms
64 bytes from 172.17.22.164:icmp_seq=3 ttl=125 time=2.07 ms</pre>
</p></li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li12206036586"><span>保存路由配置并持久化。</span><p><ol type="a" id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_ol125434522018"><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li157971192516">保存路由表的路由配置至配置文件路由文件中。<p id="ZH-CN_TOPIC_0000001447121185__p154001333366"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li157971192516"></a><a name="zh-cn_topic_0201081113_li157971192516"></a><strong id="ZH-CN_TOPIC_0000001447121185__b2400233565">policy_based_routing.sh</strong> '<strong id="ZH-CN_TOPIC_0000001447121185__b13400113314613">ip route save table</strong> <em id="ZH-CN_TOPIC_0000001447121185__i20400123311615">路由表</em>' <strong id="ZH-CN_TOPIC_0000001447121185__b19400133310619">export</strong><em id="ZH-CN_TOPIC_0000001447121185__i1540018331364"> 路由配置文件</em></p>
<p id="ZH-CN_TOPIC_0000001447121185__p1625451319318">示例如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__screen1688887123411">policy_based_routing.sh<strong id="ZH-CN_TOPIC_0000001447121185__b789277163412"> </strong>'ip route save table 200' export route_table_200</pre>
</li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li26482314252">对已保存的路由配置文件进行持久化。<p id="ZH-CN_TOPIC_0000001447121185__p027035193216"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li26482314252"></a><a name="zh-cn_topic_0201081113_li26482314252"></a><strong id="ZH-CN_TOPIC_0000001447121185__b172704513322">policy_based_routing.sh</strong> <strong id="ZH-CN_TOPIC_0000001447121185__b162701951183213">ip route </strong><strong id="ZH-CN_TOPIC_0000001447121185__b152701251193215">persist</strong> <em id="ZH-CN_TOPIC_0000001447121185__i1227015163215">路由配置文件</em></p>
<p id="ZH-CN_TOPIC_0000001447121185__p822194914315">示例如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__screen11630105319316">policy_based_routing.sh ip route persist route_table_200</pre>
</li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li10421112103111">保存路由策略配置至路由策略配置文件中。<p id="ZH-CN_TOPIC_0000001447121185__p10252111133314"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li10421112103111"></a><a name="zh-cn_topic_0201081113_li10421112103111"></a><strong id="ZH-CN_TOPIC_0000001447121185__b1925211193313">policy_based_routing.sh</strong> <strong id="ZH-CN_TOPIC_0000001447121185__b0252181183316">'ip rule save' export</strong> <em id="ZH-CN_TOPIC_0000001447121185__i1225251133315">路由策略配置文件</em></p>
<p id="ZH-CN_TOPIC_0000001447121185__p74691112329">示例如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__screen1176817153326">policy_based_routing.sh 'ip rule save' export rule_config_200</pre>
</li><li id="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li89588176339">对已保存的策略配置文件进行持久化。<p id="ZH-CN_TOPIC_0000001447121185__p7222413113316"><a name="ZH-CN_TOPIC_0000001447121185__zh-cn_topic_0201081113_li89588176339"></a><a name="zh-cn_topic_0201081113_li89588176339"></a><strong id="ZH-CN_TOPIC_0000001447121185__b522251317334">policy_based_routing.sh ip rule </strong><strong id="ZH-CN_TOPIC_0000001447121185__b132225131332">persist</strong> <em id="ZH-CN_TOPIC_0000001447121185__i182221713163318">路由策略配置文件</em></p>
<p id="ZH-CN_TOPIC_0000001447121185__p10519341123215">示例如下：</p>
<pre class="screen" id="ZH-CN_TOPIC_0000001447121185__screen154541433163215">policy_based_routing.sh ip rule persist rule_config_200</pre>
</li></ol>
</p></li></ol>
</div>
</div>

</body>
</html>