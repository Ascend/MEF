component: MEF_Edge
product: MEF_Edge
systemEnv:
  - workspace
  - processor
  - version
TOP_DIR: "{{systemEnv.workspace}}/{{component}}"
INSTALLER_NAME: "edge-installer"
INSTALLER_DIR: "{{systemEnv.workspace}}/{{component}}/{{INSTALLER_NAME}}"
compile:
  input:
    dependency:
      - name: MEF_Dependency
        version: "1.0"
        type: opensource
        buildFile: "{{TOP_DIR}}/build/conf"
      - name: "{{INSTALLER_NAME}}"
        version: "1.0"
        type: opensource
        buildFile: "{{INSTALLER_DIR}}/build/conf"
    include:
      - commands:
          - command: "cd {{INSTALLER_DIR}} && go mod tidy"

  process:
    language: go
    compilePath:
    parameters:
  output:
    files:
      include:
        - copy:
            src:
              - '{{INSTALLER_DIR}}/output/*.tar.gz'
            des: "{{TOP_DIR}}/output/"
        - copy:
            src:
              - '{{INSTALLER_DIR}}/config/software.xml'
            des: "{{TOP_DIR}}/output/"
        - commands:
            - command: "fakeroot rm -rf {{TOP_DIR}}/output/lib {{TOP_DIR}}/output/include"
            - command: "bash {{ systemEnv.workspace }}/../CI/CleanCode/script/signature.sh MEF_Edge"
        - copy:
            src:
              - '{{INSTALLER_DIR}}/output/*.tar.gz'
            des: "{{TOP_DIR}}/output/"
        - commands:
            - command: "cp {{TOP_DIR}}/output/crldata.crl {{TOP_DIR}}/output/software.xml.crl"
            - command: "mv {{TOP_DIR}}/output/crldata.crl {{TOP_DIR}}/output/Ascend-mindxedge-mefedge_{{version}}_linux-{{systemEnv.processor}}.tar.gz.crl"
        - mode:
            src:
              - "{{TOP_DIR}}/output/*"
            mode: "400"
        - makeArchive:
            - src: "{{TOP_DIR}}/output/"
              des: "{{TOP_DIR}}/output/Ascend-mindxedge-mefedge_{{version}}_linux-{{systemEnv.processor}}"
              prefix: zip
              arch: "{{systemEnv.processor}}"
        - commands:
            - command: "sh {{TOP_DIR}}/build/common_utils_dt_exclude.sh"