component: edge-om
product: MEF_Edge_SDK
systemEnv:
  - workspace
  - processor
  - version
TOP_DIR: "{{systemEnv.workspace}}/{{product}}/edge-installer"
CUR_DIR: "{{TOP_DIR}}/cmd/{{component}}"
compile:
  input:
    envVariables:
      GO111MODULE: "on"
      GONOSUMDB: "*"
      GOPROXY: "https://cmc.centralrepo.rnd.huawei.com/artifactory/go-central-repo,direct"
      CGO_ENABLED: "1"
      CGO_CFLAGS: "-fstack-protector-strong -D_FORTIFY_SOURCE=2 -O2 -fPIC -ftrapv"
      CGO_CPPFLAGS: "-fstack-protector-strong -D_FORTIFY_SOURCE=2 -O2 -fPIC -ftrapv"
  process:
    language: go
    compilePath: "{{CUR_DIR}}"
    parameters: [ [ 'buildmode', "pie" ],
                  [ "mod", "mod" ],
                  [ "tags", "MEFEdge_SDK" ],
                  [ 'ldflags', '-X "main.BuildName={{component}}" -X "main.BuildVersion={{version}}_linux-{{systemEnv.processor}}" -s -linkmode=external -extldflags=-Wl,-z,now' ],
                  [ "o", "{{component}}" ],
                  [ 'trimpath',"" ], ]
  output:
    files: